var cidadeLuzIda = [
          {lng:-41.3211368,lat:-21.7560009},
          {lng:-41.3213272,lat:-21.755925},
          {lng:-41.3214368,lat:-21.7558736},
          {lng:-41.3214895,lat:-21.7558412},
          {lng:-41.3215441,lat:-21.7557917},
          {lng:-41.3217238,lat:-21.7555908},
          {lng:-41.3217926,lat:-21.755523},
          {lng:-41.3218506,lat:-21.7554572},
          {lng:-41.3219149,lat:-21.7554031},
          {lng:-41.3223303,lat:-21.7552156},
          {lng:-41.3225466,lat:-21.7551178},
          {lng:-41.3228202,lat:-21.7550048},
          {lng:-41.3229231,lat:-21.7549615},
          {lng:-41.323368,lat:-21.7547915},
          {lng:-41.323769,lat:-21.7546408},
          {lng:-41.323827,lat:-21.7546177},
          {lng:-41.3242263,lat:-21.7544368},
          {lng:-41.3244439,lat:-21.754339},
          {lng:-41.3247296,lat:-21.7541111},
          {lng:-41.3249147,lat:-21.753965},
          {lng:-41.325155,lat:-21.7537119},
          {lng:-41.3253579,lat:-21.7534908},
          {lng:-41.3255326,lat:-21.7533198},
          {lng:-41.3257492,lat:-21.7531183},
          {lng:-41.3259198,lat:-21.7529452},
          {lng:-41.326119,lat:-21.7527471},
          {lng:-41.3263604,lat:-21.7525067},
          {lng:-41.3265149,lat:-21.7523429},
          {lng:-41.3266222,lat:-21.7522922},
          {lng:-41.3267738,lat:-21.7520776},
          {lng:-41.3270182,lat:-21.7517351},
          {lng:-41.3271691,lat:-21.7515246},
          {lng:-41.3274088,lat:-21.7511892},
          {lng:-41.3276599,lat:-21.7508373},
          {lng:-41.3278564,lat:-21.7505443},
          {lng:-41.3281102,lat:-21.750241},
          {lng:-41.3283623,lat:-21.7499302},
          {lng:-41.3284595,lat:-21.7498093},
          {lng:-41.3285232,lat:-21.7497306},
          {lng:-41.3287311,lat:-21.7494313},
          {lng:-41.3289588,lat:-21.749104},
          {lng:-41.3291525,lat:-21.7488244},
          {lng:-41.3292705,lat:-21.748658},
          {lng:-41.3293852,lat:-21.7484915},
          {lng:-41.3295478,lat:-21.7482592},
          {lng:-41.3296997,lat:-21.74804},
          {lng:-41.3297631,lat:-21.7479453},
          {lng:-41.3299103,lat:-21.7477138},
          {lng:-41.3299953,lat:-21.7475733},
          {lng:-41.3300937,lat:-21.7474078},
          {lng:-41.3302791,lat:-21.7471128},
          {lng:-41.3305211,lat:-21.7467214},
          {lng:-41.3306814,lat:-21.7464623},
          {lng:-41.3307022,lat:-21.7464268},
          {lng:-41.3308775,lat:-21.7461325},
          {lng:-41.33108,lat:-21.7457965},
          {lng:-41.3312584,lat:-21.7455237},
          {lng:-41.3314609,lat:-21.7452092},
          {lng:-41.3316792,lat:-21.7448697},
          {lng:-41.3318529,lat:-21.7445966},
          {lng:-41.332057,lat:-21.744278},
          {lng:-41.3321409,lat:-21.7441485},
          {lng:-41.3322062,lat:-21.7440121},
          {lng:-41.3323481,lat:-21.7437256},
          {lng:-41.3323819,lat:-21.7436602},
          {lng:-41.3324262,lat:-21.7435477},
          {lng:-41.3324966,lat:-21.7433456},
          {lng:-41.3324832,lat:-21.74326},
          {lng:-41.3324091,lat:-21.7431332},
          {lng:-41.3320755,lat:-21.7429358},
          {lng:-41.3317198,lat:-21.7427228},
          {lng:-41.3313449,lat:-21.7425014},
          {lng:-41.3309265,lat:-21.742251},
          {lng:-41.3305889,lat:-21.7420498},
          {lng:-41.3302781,lat:-21.7418819},
          {lng:-41.3301232,lat:-21.7417816},
          {lng:-41.3297835,lat:-21.7416063},
          {lng:-41.3297058,lat:-21.7415668},
          {lng:-41.3294389,lat:-21.7414114},
          {lng:-41.3292682,lat:-21.7412992},
          {lng:-41.3291318,lat:-21.7412074},
          {lng:-41.3290114,lat:-21.7411199},
          {lng:-41.3288997,lat:-21.7410271},
          {lng:-41.3287197,lat:-21.7408583},
          {lng:-41.3286091,lat:-21.7407493},
          {lng:-41.3285618,lat:-21.7407019},
          {lng:-41.3283177,lat:-21.7404279},
          {lng:-41.328199,lat:-21.7402852},
          {lng:-41.3280179,lat:-21.7400379},
          {lng:-41.3278721,lat:-21.7398175},
          {lng:-41.3277182,lat:-21.7395549},
          {lng:-41.3275808,lat:-21.7393064},
          {lng:-41.3274436,lat:-21.7390629},
          {lng:-41.327336,lat:-21.7388726},
          {lng:-41.3271902,lat:-21.7386054},
          {lng:-41.3270772,lat:-21.7384051},
          {lng:-41.3269525,lat:-21.7381806},
          {lng:-41.3268251,lat:-21.7379483},
          {lng:-41.3267275,lat:-21.7377686},
          {lng:-41.3266058,lat:-21.7375478},
          {lng:-41.326522,lat:-21.7373858},
          {lng:-41.3263892,lat:-21.7371476},
          {lng:-41.3262581,lat:-21.7369127},
          {lng:-41.3261491,lat:-21.7367187},
          {lng:-41.3260385,lat:-21.736502},
          {lng:-41.325894,lat:-21.7362238},
          {lng:-41.3257773,lat:-21.7359962},
          {lng:-41.3257817,lat:-21.7359305},
          {lng:-41.3257901,lat:-21.7358918},
          {lng:-41.3258082,lat:-21.7358585},
          {lng:-41.3258273,lat:-21.7358442},
          {lng:-41.3258534,lat:-21.7358405},
          {lng:-41.3258729,lat:-21.7358414},
          {lng:-41.3259248,lat:-21.7358498},
          {lng:-41.3259641,lat:-21.7358607},
          {lng:-41.326064,lat:-21.7359467},
          {lng:-41.3262678,lat:-21.7361223},
          {lng:-41.3264723,lat:-21.7363023},
          {lng:-41.326648,lat:-21.7364552},
          {lng:-41.3266829,lat:-21.7364854},
          {lng:-41.3269575,lat:-21.7367116},
          {lng:-41.3271395,lat:-21.7368614},
          {lng:-41.3274986,lat:-21.73716},
          {lng:-41.3276934,lat:-21.7373204},
          {lng:-41.3278973,lat:-21.737497},
          {lng:-41.3278973,lat:-21.737497},
          {lng:-41.3284089,lat:-21.7379464},
          {lng:-41.3286597,lat:-21.7381669},
          {lng:-41.3291395,lat:-21.7385851},
          {lng:-41.3293242,lat:-21.7387409},
          {lng:-41.329575,lat:-21.7389514},
          {lng:-41.3299257,lat:-21.7392441},
          {lng:-41.3304326,lat:-21.7396546},
          {lng:-41.330893,lat:-21.7400289},
          {lng:-41.3310579,lat:-21.7401625},
          {lng:-41.3312769,lat:-21.7402672},
          {lng:-41.331361,lat:-21.7399607},
          {lng:-41.3314153,lat:-21.7397633},
          {lng:-41.33154,lat:-21.7395472},
          {lng:-41.3316537,lat:-21.7393952},
          {lng:-41.3319863,lat:-21.7388882},
          {lng:-41.3321308,lat:-21.7386711},
          {lng:-41.3322176,lat:-21.7385543},
          {lng:-41.332393,lat:-21.7383883},
          {lng:-41.3323804,lat:-21.7383633},
          {lng:-41.33238,lat:-21.738346},
          {lng:-41.3323867,lat:-21.7383191},
          {lng:-41.3324745,lat:-21.7381825},
          {lng:-41.3325677,lat:-21.7380429},
          {lng:-41.3326025,lat:-21.7379567},
          {lng:-41.3326374,lat:-21.737853},
          {lng:-41.3326736,lat:-21.7376829},
          {lng:-41.3327082,lat:-21.73752},
          {lng:-41.3327283,lat:-21.7374222},
          {lng:-41.332734,lat:-21.7373198},
          {lng:-41.3327192,lat:-21.7370962},
          {lng:-41.3327122,lat:-21.7369781},
          {lng:-41.33269,lat:-21.7367654},
          {lng:-41.3326599,lat:-21.7366082},
          {lng:-41.3326143,lat:-21.7364496},
          {lng:-41.3325479,lat:-21.7362609},
          {lng:-41.3324446,lat:-21.7360501},
          {lng:-41.3323846,lat:-21.7359049},
          {lng:-41.3322994,lat:-21.7356938},
          {lng:-41.3322056,lat:-21.7354589},
          {lng:-41.3321482,lat:-21.7353188},
          {lng:-41.3320309,lat:-21.7351849},
          {lng:-41.332,lat:-21.7351475},
          {lng:-41.3319018,lat:-21.7350535},
          {lng:-41.3317794,lat:-21.734951},
          {lng:-41.3312899,lat:-21.7345869},
          {lng:-41.3310402,lat:-21.7344004},
          {lng:-41.3309097,lat:-21.7342895},
          {lng:-41.3308028,lat:-21.7341954},
          {lng:-41.3307622,lat:-21.7341559},
          {lng:-41.3307129,lat:-21.7340914},
          {lng:-41.3306794,lat:-21.7340431},
          {lng:-41.3306107,lat:-21.7339223},
          {lng:-41.3305738,lat:-21.7338454},
          {lng:-41.330447,lat:-21.7335778},
          {lng:-41.3304068,lat:-21.7334922},
          {lng:-41.330384,lat:-21.7334227},
          {lng:-41.3303304,lat:-21.7333742},
          {lng:-41.3302962,lat:-21.7331929},
          {lng:-41.3302348,lat:-21.7328646},
          {lng:-41.3301768,lat:-21.7323841},
          {lng:-41.3301567,lat:-21.7322109},
          {lng:-41.3301413,lat:-21.7321455},
          {lng:-41.3300813,lat:-21.7318079},
          {lng:-41.3300729,lat:-21.7317612},
          {lng:-41.3298704,lat:-21.7314868},
          {lng:-41.329699,lat:-21.7312548},
          {lng:-41.3295465,lat:-21.7310517},
          {lng:-41.3294379,lat:-21.7309091},
          {lng:-41.329351,lat:-21.7307954},
          {lng:-41.3292773,lat:-21.7306979},
          {lng:-41.3291385,lat:-21.7305749},
          {lng:-41.3290587,lat:-21.7304979},
          {lng:-41.3289452,lat:-21.7303846},
          {lng:-41.32883,lat:-21.7302706},
          {lng:-41.3286855,lat:-21.7301301},
          {lng:-41.3285594,lat:-21.7300115},
          {lng:-41.3283744,lat:-21.7298632},
          {lng:-41.328202,lat:-21.7297539},
          {lng:-41.3280089,lat:-21.7296284},
          {lng:-41.3279291,lat:-21.7295754},
          {lng:-41.3278841,lat:-21.7295467},
          {lng:-41.3279409,lat:-21.7294586},
          {lng:-41.3280964,lat:-21.7293051},
          {lng:-41.3283643,lat:-21.7290379},
          {lng:-41.3286345,lat:-21.7287681},
          {lng:-41.3289276,lat:-21.7284829},
          {lng:-41.3291331,lat:-21.7282801},
          {lng:-41.329224,lat:-21.728191},
          {lng:-41.3293483,lat:-21.7280574},
          {lng:-41.3295485,lat:-21.727849},
          {lng:-41.32975,lat:-21.727641},
          {lng:-41.3298704,lat:-21.7275142},
          {lng:-41.3298003,lat:-21.7274071},
          {lng:-41.3296203,lat:-21.7271249},
          {lng:-41.3294825,lat:-21.7269122},
          {lng:-41.329349,lat:-21.7267185},
          {lng:-41.3291978,lat:-21.7264964},
          {lng:-41.3292015,lat:-21.7264761},
          {lng:-41.3295368,lat:-21.7262516},
          {lng:-41.329695,lat:-21.726141},
          {lng:-41.3299455,lat:-21.7259766},
          {lng:-41.3301896,lat:-21.7258068},
          {lng:-41.330274,lat:-21.7256981},
          {lng:-41.3304873,lat:-21.7255882},
          {lng:-41.3309436,lat:-21.7253521},
          {lng:-41.3314022,lat:-21.7251138},
          {lng:-41.3316842,lat:-21.724968},
          {lng:-41.3323058,lat:-21.724622},
          {lng:-41.3327467,lat:-21.7244018},
          {lng:-41.3329737,lat:-21.7243003},
          {lng:-41.3334106,lat:-21.7240604},
          {lng:-41.3337824,lat:-21.7243233},
          {lng:-41.333942,lat:-21.7245921},
          {lng:-41.3341351,lat:-21.7249173},
          {lng:-41.3342062,lat:-21.7250359},
          {lng:-41.3343745,lat:-21.7253225},
          {lng:-41.3344714,lat:-21.7254798},
          {lng:-41.3345991,lat:-21.7256969},
          {lng:-41.3347188,lat:-21.7258974},
          {lng:-41.334803,lat:-21.7260388},
          {lng:-41.3348817,lat:-21.7261687},
          {lng:-41.3349039,lat:-21.7262049}];
		  

//Funcao que calcula e armazena as distancias entre os pontos do vetor		  
function calculaDist(vetor){
	let novoVetor = [];
	for(let i = 0;i<vetor.length;i++){
		if(i+1<vetor.length){
			novoVetor.push({o: vetor[i],d: vetor[i+1],dist: parseFloat((google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(vetor[i]),new google.maps.LatLng(vetor[i+1]))))});
		}
	}
	return novoVetor;
}

//Funçao que calcula o tempo entre a posição da pessoa e a posição do onibus
function calculaTempoTeste(posPessoa,posOnibus,rota){
	let indiceOnibus = 0;
	let indicePessoa = 0;
	let distPessoa = 0;
	let menorDistPessoa = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(posPessoa),new google.maps.LatLng(rota[0].o));
	let distOnibus = 0;
	let menorDistOnibus = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(posOnibus),new google.maps.LatLng(rota[0].d));
	let soma = 0;
	
	for(let i = 0; i<rota.length; i++){
		distPessoa = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(posPessoa),new google.maps.LatLng(rota[i].o));

		distOnibus = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(posOnibus),new google.maps.LatLng(rota[i].d));
		
		if(distPessoa<menorDistPessoa){
			indicePessoa = i;
			menorDistPessoa = distPessoa;
		}
		else if(distOnibus<menorDistOnibus){
			indiceOnibus = i;
			menorDistOnibus = distOnibus;
		}
		
	}
	console.log("Indice do vetor mais próximo da pessoa: "+indicePessoa);
    console.log("Indice do vetor mais próximo do onibus: "+indiceOnibus);
    
    //for que percorre do indice da pessoa até o indice do onibus somando as distâncias
	for(let i = indicePessoa; i<=indiceOnibus; i++){
	    soma += vetor[i].dist;
	}
    
    //Divide a distância pela velocidade média para encontrar o tempo
	tempo = (soma/11.11)/60;
	tempo = tempo.toFixed(1);
	return tempo;
}

//distancia entre os pontos do vetor
vetor = calculaDist(cidadeLuzIda);

//dist total do vetor
let distTotal = 0;
for(let i = 0;i<vetor.length;i++){
	distTotal += vetor[i].dist;
}
distTotal = distTotal.toFixed(1);
console.log("Total: "+distTotal+" metros");

//posicoes aleatórias para pessoa e onibus
let posPessoa = {lat:-21.755124,lng:-41.323433};
let posOnibus = {lat:-21.724017,lng:-41.331606};

//execução
var tempo = calculaTempoTeste(posPessoa,posOnibus,vetor);
console.log("Tempo até chegada do onibus: "+tempo+" minutos");


